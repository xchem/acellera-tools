<tool id="SystemBuilder" name="SystemBuilder" version="0.1.0" python_template_version="3.5">
    <requirements>
        <requirement type="package" version="1.21.2">htmd</requirement>
        <requirement type="package" version="0.2.8">moleculekit</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        ln -s '$protein_pdb' input.pdb &&
        #if $ligand
        ln -s '$ligand' lig.mol2 &&
        ln -s '$ligfrcmod' lig.frcmod &&
        #end if
        python '$__tool_directory__/app.py'
        -protein input.pdb

        #if $ligand
        -ligand lig.mol2 -ligfrcmod lig.frcmod
        #end if

        #if $saltconc
        -saltconc $saltconc
        #end if

        #if $mindist
        -mindist $mindist
        #end if
    ]]></command>
    <inputs>
        <param type="data" name="protein_pdb" format="pdb" />
        <param type="data" name="ligand" format="mol2" optional="true"/>
        <param type="data" name="ligfrcmod" format="frcmod" optional="true"/>
        <param name="saltconc" type="float" value="0.0" optional="true" label="The salt concentration in molar (M)"/>
        <param name="mindist" type="float" value="0.0" optional="true" label="Additional water padding to add to the system"/>
    </inputs>
    <outputs>
        <data name="struct_pdb" format="pdb" from_work_dir="build_1/structure.pdb" />
        <data name="struct_prmtop" format="prmtop" from_work_dir="build_1/structure.prmtop" />
    </outputs>
    <tests>
        <test>
            <param name="protein_pdb" value="input.pdb"/>
            <param name="ligand" value="mol-orig.mol2"/>
            <param name="ligfrcmod" value="mol.frcmod"/>
            <output name="struct_prmtop" file="structure.prmtop" compare="sim_size"/>
            <output name="struct_pdb" file="structure.pdb" compare="sim_size"/>
        </test>
        <test>
            <param name="protein_pdb" value="input.pdb"/>
            <output name="struct_prmtop" file="structure.prmtop" compare="sim_size" delta="100000"/>
            <output name="struct_pdb" file="structure.pdb" compare="sim_size" delta="100000"/>
        </test>

    </tests>
    <help><![CDATA[
Creates a protein or protein-ligand system to go trough MD simulation.

Check license conditions at: https://software.acellera.com/news/license.pdf

A .pdb file of the protein to simulate has to be provided. The protein must be prepared, you can use ProteinPrepare.

If you want to build a protein-ligand system, you also need to provide a .mol2 and a .frcmod file for the ligand. You can generate the later with the Parameterization tool.

You can add more water padding to the system increasing the value of the Water padding field. 

You can also modify the salt concentration. By default, ions will be used to balance the charge of the protein and ligand.

A simulation box with the protein and the ligand (if provided) will be generated ready to simulate.

    ]]></help>

    <citations>
        <citation type="doi">10.1021/acs.jctc.6b00049</citation>
    </citations>
</tool>
